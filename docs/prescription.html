<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prescription | SmartCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- GLOBAL NAVBAR -->
<nav>
  <h2>ğŸ¥ SmartCare</h2>
  <div style="display:flex;gap:18px;align-items:center;">
    <a href="index.html">Home</a>
    <a href="appointments.html">Appointments</a>
    <a href="doctors.html">Doctors</a>
    <a href="prescription.html"><b>Prescription</b></a>
    <a href="admin.html">Admin</a>
  </div>
</nav>

<!-- DOCTOR LOGIN -->
<section class="section light" id="doctorLoginBox">
  <h3>ğŸ” Doctor Login</h3>
  <p style="color:gray;font-size:14px;">
    Login required to create prescriptions.
  </p>

  <input id="docUser" placeholder="Username (ex: drrao)">
  <input id="docPass" type="password" placeholder="Password">
  <button onclick="doctorLoginFromPrescription()">Login</button>

  <p id="loginError" style="color:red;"></p>
</section>

<!-- PRESCRIPTION MODULE -->
<section class="section" id="prescriptionModule" style="display:none;">
  <div style="display:grid;grid-template-columns:1.1fr 0.9fr;gap:30px;">

    <!-- LEFT: FORM -->
    <div>
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h2>ğŸ’Š Create Prescription</h2>
        <button onclick="doctorLogout()" class="btn-danger">Logout</button>
      </div>

      <p style="color:gray;font-size:14px;">
        Logged in as <b id="doctorNameText"></b>
      </p>

      <input id="prePatient" placeholder="Patient Name" required oninput="updatePreview()">

      <label style="margin-top:10px;display:block;">Prescription Template</label>
      <select id="prescriptionTemplate" onchange="applyTemplate()" required>
        <option value="">-- Select Template --</option>
        <option value="fever">Fever / Viral</option>
        <option value="diabetes">Diabetes Follow-up</option>
        <option value="bp">Hypertension (BP)</option>
        <option value="general">General OPD</option>
      </select>

      <textarea id="medicine" placeholder="Medicines & Advice" required oninput="updatePreview()"></textarea>

      <button onclick="savePrescription()">Save Prescription</button>

      <h3 style="margin-top:30px;">ğŸ“„ My Prescriptions</h3>
      <ul id="prescriptionList"></ul>
    </div>

    <!-- RIGHT: LIVE PREVIEW -->
    <div class="card">
      <h3 style="margin-bottom:10px;">ğŸ§¾ Prescription Preview</h3>

      <p><b>Doctor:</b> <span id="pvDoctor">-</span></p>
      <p><b>Patient:</b> <span id="pvPatient">-</span></p>
      <p><b>Template:</b> <span id="pvTemplate">-</span></p>

      <hr>

      <p><b>Medicines & Advice:</b></p>
      <p id="pvMedicine" style="white-space:pre-line;color:#374151;">-</p>

      <hr>
      <p><small>Date: <span id="pvDate"></span></small></p>
    </div>

  </div>
</section>

<script src="script.js"></script>

<script>
/* ========= TEMPLATES ========= */
const templates = {
  fever:
`Paracetamol 650mg â€“ Twice daily
Cetirizine â€“ Once at night
Warm fluids and rest

Advice:
â€¢ Take adequate rest
â€¢ Drink plenty of fluids`,
  diabetes:
`Metformin 500mg â€“ Twice daily
Monitor blood sugar levels

Advice:
â€¢ Follow diabetic diet
â€¢ Regular exercise`,
  bp:
`Amlodipine 5mg â€“ Once daily
Low salt diet

Advice:
â€¢ Monitor BP regularly
â€¢ Avoid stress`,
  general:
`Multivitamin â€“ Once daily

Advice:
â€¢ Balanced diet
â€¢ Adequate hydration`
};

/* ========= PAGE FLOW ========= */
function initPrescriptionPage() {
  const doctor = localStorage.getItem("doctorName");
  if (doctor) showPrescriptionModule(doctor);
}

function doctorLoginFromPrescription() {
  const u = docUser.value.toLowerCase().trim();
  const p = docPass.value.trim();

  const accounts = {
    drrao: "Dr. A. Rao",
    drmeena: "Dr. Meena S.",
    drkumar: "Dr. K. Kumar",
    drsharma: "Dr. P. Sharma"
  };

  if (accounts[u] && p === "doctor") {
    localStorage.setItem("doctorName", accounts[u]);
    showPrescriptionModule(accounts[u]);
  } else {
    loginError.textContent = "Invalid credentials";
  }
}

function showPrescriptionModule(name) {
  doctorLoginBox.style.display = "none";
  prescriptionModule.style.display = "block";
  doctorNameText.textContent = name;
  pvDoctor.textContent = name;
  pvDate.textContent = new Date().toLocaleDateString();
  loadPrescriptions();
}

/* ========= TEMPLATE APPLY ========= */
function applyTemplate() {
  const key = prescriptionTemplate.value;
  if (templates[key]) {
    medicine.value = templates[key];
    pvTemplate.textContent = prescriptionTemplate.options[prescriptionTemplate.selectedIndex].text;
    updatePreview();
  }
}

/* ========= LIVE PREVIEW ========= */
function updatePreview() {
  pvPatient.textContent = prePatient.value || "-";
  pvMedicine.textContent = medicine.value || "-";
}

/* ========= STORAGE ========= */
function getPrescriptions() {
  return JSON.parse(localStorage.getItem("prescriptions")) || [];
}

function savePrescriptions(data) {
  localStorage.setItem("prescriptions", JSON.stringify(data));
}

/* ========= SAVE ========= */
function savePrescription() {
  const patient = prePatient.value.trim();
  const templateText = prescriptionTemplate.options[prescriptionTemplate.selectedIndex].text;
  const medicineText = medicine.value.trim();
  const doctor = localStorage.getItem("doctorName");

  if (!patient || !medicineText) {
    alert("Fill all fields");
    return;
  }

  const list = getPrescriptions();
  list.push({
    doctor,
    patient,
    template: templateText,
    medicine: medicineText,
    date: new Date().toLocaleDateString()
  });

  savePrescriptions(list);

  prePatient.value = "";
  prescriptionTemplate.value = "";
  medicine.value = "";
  updatePreview();
  loadPrescriptions();
}

/* ========= LOAD ========= */
function loadPrescriptions() {
  prescriptionList.innerHTML = "";
  const doctor = localStorage.getItem("doctorName");

  const my = getPrescriptions().filter(p => p.doctor === doctor);
  if (!my.length) {
    prescriptionList.innerHTML = "<li>No prescriptions yet</li>";
    return;
  }

  my.forEach(p => {
    const li = document.createElement("li");
    li.innerHTML = `<b>${p.patient}</b> â€“ ${p.template}<br><small>${p.date}</small>`;
    prescriptionList.appendChild(li);
  });
}

initPrescriptionPage();
</script>

</body>
</html>
