<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctors | SmartCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav>
  <h2>üè• SmartCare</h2>
  <div>
    <a href="index.html">Home</a>
    <a href="appointments.html">Appointments</a>
    <a href="doctors.html"><b>Doctors</b></a>
    <a href="prescription.html">Prescription</a>
    <a href="admin-login.html">Admin</a>
  </div>
</nav>

<!-- DOCTOR LOGIN -->
<section class="section light" id="loginBox">
  <h3>üîê Doctor Login</h3>
  <input id="docUser" placeholder="Username (drrao)">
  <input id="docPass" type="password" placeholder="Password">
  <button onclick="doctorLogin()">Login</button>
  <p id="loginError" style="color:red;"></p>
</section>

<!-- DASHBOARD -->
<section class="section" id="dashboard" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h3>üìã My Appointments</h3>
    <button class="btn-danger" onclick="doctorLogout()">Logout</button>
  </div>

  <p style="color:gray;font-size:14px;">
    Logged in as <b id="doctorNameText"></b>
  </p>

  <div id="appointments" class="card-grid"></div>
</section>

<script>
const API = "https://smartcare-hospital.onrender.com";

/* ===== Doctor Accounts ===== */
const doctors = {
  drrao: "Dr. A. Rao",
  drmeena: "Dr. Meena S.",
  drkumar: "Dr. K. Kumar",
  drsharma: "Dr. P. Sharma"
};

/* ===== Login ===== */
function doctorLogin() {
  const u = docUser.value.trim().toLowerCase();
  const p = docPass.value.trim();

  if (doctors[u] && p === "doctor") {
    localStorage.setItem("doctorName", doctors[u]);
    showDashboard(doctors[u]);
  } else {
    loginError.textContent = "Invalid credentials";
  }
}

/* ===== Dashboard ===== */
async function showDashboard(name) {
  loginBox.style.display = "none";
  dashboard.style.display = "block";
  doctorNameText.textContent = name;

  appointments.innerHTML = "<p>Loading...</p>";

  try {
    const res = await fetch(`${API}/appointments-all`);
    const data = await res.json();

    const my = data.filter(a => a.doctor === name);
    appointments.innerHTML = "";

    if (!my.length) {
      appointments.innerHTML = "<p>No appointments yet</p>";
      return;
    }

    my.forEach(a => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <b>Patient:</b> ${a.patientName}<br>
        <b>Date:</b> ${a.date}
      `;
      appointments.appendChild(card);
    });

  } catch {
    appointments.innerHTML = "<p>Error loading appointments</p>";
  }
}

/* ===== Logout ===== */
function doctorLogout() {
  localStorage.removeItem("doctorName");
  location.reload();
}

/* ===== Auto Restore ===== */
const saved = localStorage.getItem("doctorName");
if (saved) showDashboard(saved);
</script>

</body>
</html>
