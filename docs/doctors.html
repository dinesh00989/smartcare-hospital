<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Doctors | SmartCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<nav>
  <h2>ğŸ¥ SmartCare</h2>
  <div style="display:flex;gap:18px;align-items:center;">
    <a href="index.html">Home</a>
    <a href="appointments.html">Appointments</a>
    <a href="doctors.html"><b>Doctors</b></a>
    <a href="prescription.html">Prescription</a>
    <a href="admin-login.html">Admin</a>
  </div>
</nav>

<section class="section">
  <h2>ğŸ‘¨â€âš•ï¸ Our Doctors</h2>
  <input id="doctorSearch" placeholder="Search by name or specialization">
  <ul id="doctorList" class="doctor-list"></ul>
</section>

<section class="section light" id="doctorLoginBox">
  <h3>ğŸ” Doctor Login</h3>
  <input id="docUser" placeholder="Username (ex: drrao)">
  <input id="docPass" type="password" placeholder="Password">
  <button onclick="doctorLogin()">Login</button>
  <p id="loginError" style="color:red;"></p>
</section>

<section class="section" id="doctorDashboard" style="display:none;">
  <div style="display:flex;justify-content:space-between;align-items:center;">
    <h3>ğŸ“‹ My Appointments</h3>
    <button class="btn-danger" onclick="doctorLogout()">Logout</button>
  </div>
  <div id="doctorAppointmentCards" class="card-grid"></div>
</section>

<!-- RIGHT PANEL -->
<div class="doctor-panel" id="doctorPanel">
  <button class="close-btn" onclick="closeDoctorPanel()">Ã—</button>
  <div class="panel-content">
    <img id="panelPhoto" class="panel-photo">
    <h3 id="panelName"></h3>
    <p id="panelSpec"></p>
    <span id="panelStatus" class="status-badge"></span>
    <p><b>Experience:</b> <span id="panelExp"></span></p>
    <p><b>Qualification:</b> <span id="panelQual"></span></p>
    <p><b>Languages:</b> <span id="panelLang"></span></p>
    <h4>Expertise</h4>
    <ul id="panelExpertise"></ul>
    <h4>Career Highlights</h4>
    <ul id="panelStats"></ul>
  </div>
</div>

<script>
const API = "https://smartcare-hospital.onrender.com";

/* ========= DOCTOR DATA (UI ONLY) ========= */
const doctors = [
  { username:"drrao", name:"Dr. A. Rao", speciality:"General Physician", exp:"18+ Years", qual:"MBBS, MD", lang:"English, Telugu", status:"Available", photo:"https://i.pravatar.cc/150?img=12", expertise:["Preventive Care"], stats:["12,000+ patients"] },
  { username:"drmeena", name:"Dr. Meena S.", speciality:"Pediatrician", exp:"14+ Years", qual:"MBBS, MD", lang:"English, Telugu", status:"Available", photo:"https://i.pravatar.cc/150?img=32", expertise:["Child Care"], stats:["9,000+ children"] },
  { username:"drkumar", name:"Dr. K. Kumar", speciality:"Orthopedic", exp:"16+ Years", qual:"MBBS, MS", lang:"English, Hindi", status:"Limited", photo:"https://i.pravatar.cc/150?img=56", expertise:["Joint Replacement"], stats:["2,000+ surgeries"] },
  { username:"drsharma", name:"Dr. P. Sharma", speciality:"Cardiologist", exp:"20+ Years", qual:"MBBS, DM", lang:"English, Hindi", status:"Available", photo:"https://i.pravatar.cc/150?img=68", expertise:["Heart Disease"], stats:["4,500+ procedures"] }
];

/* ========= RENDER DOCTORS ========= */
const list = document.getElementById("doctorList");
doctors.forEach(d => {
  const li = document.createElement("li");
  li.innerHTML = `<strong>${d.name}</strong><br>${d.speciality}`;
  li.onclick = () => openDoctorPanel(d);
  list.appendChild(li);
});

/* ========= LOGIN ========= */
async function doctorLogin() {
  const username = docUser.value.trim();
  const password = docPass.value.trim();
  loginError.textContent = "";

  try {
    const res = await fetch(`${API}/login`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      credentials: "include",
      body: JSON.stringify({ username, password })
    });

    if (!res.ok) throw new Error();
    const data = await res.json();
    if (data.role !== "doctor") throw new Error();

    doctorLoginBox.style.display = "none";
    doctorDashboard.style.display = "block";
    loadDoctorAppointments();

  } catch {
    loginError.textContent = "Invalid doctor credentials";
  }
}

/* ========= LOAD APPOINTMENTS ========= */
function loadDoctorAppointments() {
  fetch(`${API}/appointments`, { credentials: "include" })
    .then(res => res.json())
    .then(data => {
      doctorAppointmentCards.innerHTML = "";
      if (!data.length) {
        doctorAppointmentCards.innerHTML = "<p>No appointments yet</p>";
        return;
      }
      data.forEach(a => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<b>${a.patientName}</b><br>Date: ${a.date}`;
        doctorAppointmentCards.appendChild(div);
      });
    });
}

/* ========= LOGOUT ========= */
function doctorLogout() {
  fetch(`${API}/logout`, { method:"POST", credentials:"include" })
    .then(() => location.reload());
}

/* ========= PANEL ========= */
function openDoctorPanel(d) {
  doctorPanel.classList.add("open");
  panelPhoto.src = d.photo;
  panelName.textContent = d.name;
  panelSpec.textContent = d.speciality;
  panelStatus.textContent = d.status;
  panelExp.textContent = d.exp;
  panelQual.textContent = d.qual;
  panelLang.textContent = d.lang;
  panelExpertise.innerHTML = d.expertise.map(e=>`<li>${e}</li>`).join("");
  panelStats.innerHTML = d.stats.map(s=>`<li>${s}</li>`).join("");
}

function closeDoctorPanel() {
  doctorPanel.classList.remove("open");
}
</script>

</body>
</html>
