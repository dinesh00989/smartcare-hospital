<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | SmartCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

  <style>
    body { background:#f8fafc; }

    .center-wrap {
      min-height: calc(100vh - 80px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-card, .admin-card {
      background:#fff;
      padding:35px;
      width:100%;
      max-width:420px;
      border-radius:16px;
      box-shadow:0 20px 45px rgba(0,0,0,0.12);
      animation:fadeIn .4s ease;
    }

    .login-card h2 {
      text-align:center;
      margin-bottom:20px;
    }

    input {
      width:100%;
      padding:12px;
      margin:8px 0;
      border-radius:8px;
      border:1px solid #ccc;
    }

    button {
      width:100%;
      padding:14px;
      margin-top:12px;
      background:#2563eb;
      color:#fff;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-size:15px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow:0 10px 25px rgba(37,99,235,.4);
    }

    .stats {
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(120px,1fr));
      gap:15px;
      margin-bottom:25px;
    }

    .stat {
      background:#eef2ff;
      padding:15px;
      border-radius:12px;
      text-align:center;
      font-weight:bold;
    }

    ul { padding-left:18px; }

    @keyframes fadeIn {
      from {opacity:0; transform:translateY(10px);}
      to {opacity:1; transform:translateY(0);}
    }
  </style>
</head>

<body>

<!-- NAVBAR -->
<nav>
  <h2>ğŸ¥ SmartCare</h2>
  <div>
    <a href="index.html">Home</a>
    <a href="appointments.html">Appointments</a>
    <a href="doctors.html">Doctors</a>
    <a href="prescription.html">Prescription</a>
    <a href="admin.html"><b>Admin</b></a>
  </div>
</nav>

<!-- ================= ADMIN LOGIN ================= -->
<div class="center-wrap" id="loginBox">
  <div class="login-card">
    <h2>ğŸ” Admin Login</h2>
    <input id="adminUser" placeholder="Username (admin)">
    <input id="adminPass" type="password" placeholder="Password">
    <button onclick="adminLogin()">Login</button>
    <p id="loginError" style="color:red;text-align:center;"></p>
  </div>
</div>

<!-- ================= ADMIN DASHBOARD ================= -->
<div class="center-wrap" id="adminBox" style="display:none;">
  <div class="admin-card" style="max-width:700px;width:100%;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h2>ğŸ“Š Admin Dashboard</h2>
      <button onclick="logout()" style="background:#ef4444;width:auto;padding:10px 16px;">Logout</button>
    </div>

    <div class="stats">
      <div class="stat">Doctors<br><span id="statDoctors">0</span></div>
      <div class="stat">Appointments<br><span id="statAppointments">0</span></div>
      <div class="stat">Prescriptions<br><span id="statPrescriptions">0</span></div>
    </div>

    <h3>ğŸ—“ï¸ Appointments</h3>
    <ul id="adminAppointments"></ul>

    <h3 style="margin-top:20px;">ğŸ’Š Prescriptions</h3>
    <ul id="adminPrescriptions"></ul>
  </div>
</div>

<script>
const API = "http://localhost:3000";

/* ========= ADMIN LOGIN ========= */
function adminLogin(){
  const username = adminUser.value.trim().toLowerCase();
  const password = adminPass.value.trim();

  if(!username || !password){
    loginError.textContent="Enter credentials";
    return;
  }

  fetch(`${API}/login`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    credentials:"include",
    body:JSON.stringify({ username, password })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.role==="admin"){
      loginBox.style.display="none";
      adminBox.style.display="flex";
      loadAdminData();
    } else {
      loginError.textContent="Access denied";
    }
  });
}

/* ========= LOAD ADMIN DATA ========= */
function loadAdminData(){
  Promise.all([
    fetch(`${API}/appointments`,{ credentials:"include" }).then(r=>r.json()),
    fetch(`${API}/prescriptions`,{ credentials:"include" }).then(r=>r.json())
  ]).then(([appointments,prescriptions])=>{
    statDoctors.textContent = 4; // seeded doctors
    statAppointments.textContent = appointments.length;
    statPrescriptions.textContent = prescriptions.length;

    adminAppointments.innerHTML = appointments.length
      ? appointments.map(a=>`<li>${a.patientName} â†’ ${a.doctor} (${a.date})</li>`).join("")
      : "<li>No appointments</li>";

    adminPrescriptions.innerHTML = prescriptions.length
      ? prescriptions.map(p=>`<li>${p.patientName} â€“ ${p.doctor}</li>`).join("")
      : "<li>No prescriptions</li>";
  });
}

/* ========= LOGOUT ========= */
function logout(){
  fetch(`${API}/logout`,{
    method:"POST",
    credentials:"include"
  }).then(()=>location.reload());
}
</script>

</body>
</html>
