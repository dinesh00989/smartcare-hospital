<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | SmartCare</title>
  <link rel="stylesheet" href="/frontend/style.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>

<!-- ================= AUTH GUARD (RUNS FIRST) ================= -->
<script>
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("role");

  if (!token || role !== "admin") {
    alert("Access denied. Admins only.");
    window.location.href = "login.html";
  }
</script>

<!-- ================= NAVBAR ================= -->
<nav>
  <h2>ğŸ¥ SmartCare</h2>
  <div style="display:flex;gap:18px;align-items:center;">
    <a href="index.html">Home</a>
    <a href="appointments.html">Appointments</a>
    <a href="doctors.html">Doctors</a>
    <a href="prescription.html">Prescription</a>
    <a href="admin.html"><b>Admin</b></a>
    <button onclick="logout()" class="btn-danger">Logout</button>
  </div>
</nav>

<!-- ================= ADMIN DASHBOARD ================= -->
<section class="section" id="adminDashboard">
  <h2>ğŸ“Š System Overview (Admin)</h2>

  <div class="stats-grid">
    <div class="stat-box">
      <h2 id="statDoctors">0</h2>
      <p>Doctors</p>
    </div>
    <div class="stat-box">
      <h2 id="statAppointments">0</h2>
      <p>Appointments</p>
    </div>
    <div class="stat-box">
      <h2 id="statPrescriptions">0</h2>
      <p>Prescriptions</p>
    </div>
  </div>

  <h3 style="margin-top:40px;">ğŸ—“ï¸ All Appointments</h3>
  <ul id="adminAppointments"></ul>

  <h3 style="margin-top:40px;">ğŸ’Š All Prescriptions</h3>
  <ul id="adminPrescriptions"></ul>

  <h3 style="margin-top:40px;">ğŸ‘¨â€âš•ï¸ Doctor Activity</h3>
  <ul id="adminDoctorStats"></ul>
</section>

<script>
/* ================= LOGOUT ================= */
function logout() {
  localStorage.removeItem("token");
  localStorage.removeItem("role");
  window.location.href = "login.html";
}

/* ================= LOAD DASHBOARD (TEMP DATA) ================= */
function loadAdminDashboard() {
  // Temporary local data until backend APIs are added
  const doctors = JSON.parse(localStorage.getItem("doctors")) || [];
  const appointments = JSON.parse(localStorage.getItem("appointments")) || [];
  const prescriptions = JSON.parse(localStorage.getItem("prescriptions")) || [];

  document.getElementById("statDoctors").innerText = doctors.length;
  document.getElementById("statAppointments").innerText = appointments.length;
  document.getElementById("statPrescriptions").innerText = prescriptions.length;

  document.getElementById("adminAppointments").innerHTML =
    appointments.length
      ? appointments.map(a => `<li>${a.patient} â†’ ${a.doctor} (${a.date})</li>`).join("")
      : "<li>No appointments</li>";

  document.getElementById("adminPrescriptions").innerHTML =
    prescriptions.length
      ? prescriptions.map(p => `<li>${p.patient} â€“ ${p.template}</li>`).join("")
      : "<li>No prescriptions</li>";

  const grouped = {};
  appointments.forEach(a => {
    grouped[a.doctor] = (grouped[a.doctor] || 0) + 1;
  });

  document.getElementById("adminDoctorStats").innerHTML =
    Object.keys(grouped).length
      ? Object.entries(grouped)
          .map(([doc, count]) => `<li>${doc} â€“ ${count} appointments</li>`)
          .join("")
      : "<li>No doctor activity</li>";
}

/* ================= INIT ================= */
loadAdminDashboard();
</script>

</body>
</html>
