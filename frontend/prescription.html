<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prescription | SmartCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

  <style>
    body { background:#f8fafc; }

    .center-wrap {
      min-height: calc(100vh - 80px);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .login-card, .prescription-card {
      background:#fff;
      padding:35px;
      width:100%;
      max-width:420px;
      border-radius:16px;
      box-shadow:0 20px 45px rgba(0,0,0,0.12);
      animation:fadeIn .4s ease;
    }

    .login-card h2,
    .prescription-card h2 {
      text-align:center;
      margin-bottom:20px;
    }

    input, textarea, select {
      width:100%;
      padding:12px;
      margin:8px 0;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:14px;
    }

    textarea { resize:none; height:80px; }

    button {
      width:100%;
      padding:14px;
      margin-top:12px;
      background:#2563eb;
      color:#fff;
      border:none;
      border-radius:10px;
      cursor:pointer;
      font-size:15px;
      transition:.2s;
    }

    button:hover {
      transform:translateY(-2px);
      box-shadow:0 10px 25px rgba(37,99,235,.4);
    }

    .template-btns select { margin-top:10px; }

    .preview {
      margin-top:15px;
      background:#f9fafb;
      border:1px dashed #ccc;
      padding:15px;
      border-radius:10px;
      font-size:14px;
    }

    .rx { font-size:22px; font-weight:bold; }

    .top-bar {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:15px;
    }

    @keyframes fadeIn {
      from {opacity:0; transform:translateY(10px);}
      to {opacity:1; transform:translateY(0);}
    }
  </style>
</head>

<body>

<!-- NAVBAR -->
<nav>
  <h2>üè• SmartCare</h2>
  <div>
    <a href="index.html">Home</a>
    <a href="appointments.html">Appointments</a>
    <a href="doctors.html">Doctors</a>
    <a href="prescription.html"><b>Prescription</b></a>
  </div>
</nav>

<!-- ================= LOGIN ================= -->
<div class="center-wrap" id="loginBox">
  <div class="login-card">
    <h2>üë®‚Äç‚öïÔ∏è Doctor Login</h2>
    <input id="docUser" placeholder="Username (drrao)">
    <input id="docPass" type="password" placeholder="Password">
    <button onclick="doctorLogin()">Login</button>
    <p id="loginError" style="color:red;text-align:center;"></p>
  </div>
</div>

<!-- ================= PRESCRIPTION ================= -->
<div class="center-wrap" id="prescriptionBox" style="display:none;">
  <div class="prescription-card">

    <div class="top-bar">
      <h2>üßæ Smart Prescription</h2>
      <button onclick="logout()" style="background:#ef4444;">Logout</button>
    </div>

    <input id="pPatient" placeholder="Patient Name">
    <input id="pDoctor" placeholder="Doctor Name">
    <input id="pDiagnosis" placeholder="Diagnosis">

    <select onchange="applyTemplate(this.value)">
      <option value="">üìã Choose Template</option>
      <option value="fever">Fever</option>
      <option value="cold">Cold & Cough</option>
      <option value="gastric">Gastric</option>
      <option value="bp">Blood Pressure</option>
    </select>

    <textarea id="pMedicines" placeholder="Medicines"></textarea>
    <textarea id="pNotes" placeholder="Advice"></textarea>

    <div class="preview" id="previewBox">
      <div class="rx">‚Ñû</div>
      <p><b>Patient:</b> ‚Äî</p>
      <p><b>Doctor:</b> ‚Äî</p>
      <p><b>Diagnosis:</b> ‚Äî</p>
      <p><b>Medicines:</b> ‚Äî</p>
      <p><b>Advice:</b> ‚Äî</p>
    </div>

    <button onclick="savePrescription()">Save Prescription</button>
  </div>
</div>

<script>
const API = "https://smartcare-hospital.onrender.com";
let loggedDoctor = "";

/* ========= LOGIN ========= */
function doctorLogin() {
  const username = docUser.value.trim().toLowerCase();
  const password = docPass.value.trim();

  if (!username || !password) {
    loginError.textContent = "Enter username & password";
    return;
  }

  fetch(`${API}/login`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    credentials:"include",
    body:JSON.stringify({ username, password })
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.role==="doctor"){
      loggedDoctor = username;
      pDoctor.value = username.toUpperCase();
      loginBox.style.display="none";
      prescriptionBox.style.display="flex";
      updatePreview();
    } else {
      loginError.textContent="Invalid credentials";
    }
  });
}

/* ========= LOGOUT ========= */
function logout(){
  fetch(`${API}/logout`,{
    method:"POST",
    credentials:"include"
  }).then(()=>location.reload());
}

/* ========= PREVIEW ========= */
["pPatient","pDoctor","pDiagnosis","pMedicines","pNotes"]
.forEach(id=>document.getElementById(id).addEventListener("input",updatePreview));

function updatePreview(){
  previewBox.innerHTML = `
    <div class="rx">‚Ñû</div>
    <p><b>Patient:</b> ${pPatient.value||"‚Äî"}</p>
    <p><b>Doctor:</b> ${pDoctor.value||"‚Äî"}</p>
    <p><b>Diagnosis:</b> ${pDiagnosis.value||"‚Äî"}</p>
    <p><b>Medicines:</b><br>${pMedicines.value||"‚Äî"}</p>
    <p><b>Advice:</b><br>${pNotes.value||"‚Äî"}</p>
  `;
}

/* ========= TEMPLATES ========= */
function applyTemplate(t){
  if(t==="fever"){
    pDiagnosis.value="Fever";
    pMedicines.value="Paracetamol 650mg ‚Äì twice daily";
    pNotes.value="Drink fluids & take rest";
  }
  if(t==="cold"){
    pDiagnosis.value="Cold & Cough";
    pMedicines.value="Cetirizine, Cough syrup";
    pNotes.value="Avoid cold items";
  }
  if(t==="gastric"){
    pDiagnosis.value="Gastric Issue";
    pMedicines.value="Omeprazole";
    pNotes.value="Avoid spicy food";
  }
  if(t==="bp"){
    pDiagnosis.value="Blood Pressure";
    pMedicines.value="Amlodipine";
    pNotes.value="Monitor BP regularly";
  }
  updatePreview();
}

/* ========= SAVE ========= */
function savePrescription(){
  if(!pPatient.value || !pDoctor.value || !pDiagnosis.value || !pMedicines.value){
    alert("Fill all required fields");
    return;
  }

  fetch(`${API}/prescriptions`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    credentials:"include",
    body:JSON.stringify({
      patientName:pPatient.value,
      doctor:pDoctor.value,
      diagnosis:pDiagnosis.value,
      medicines:pMedicines.value,
      notes:pNotes.value,
      date:new Date().toLocaleDateString()
    })
  })
  .then(res=>res.json())
  .then(()=>{
    alert("Prescription saved successfully");
    document.querySelectorAll("input,textarea").forEach(i=>i.value="");
    updatePreview();
  });
}
</script>

</body>
</html>
